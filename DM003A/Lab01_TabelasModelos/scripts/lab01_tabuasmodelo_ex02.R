
library(tibble)   # tribble
library(dplyr)    # mutate, transmute, ...
library(tidyr)    # pivot_longer, pivot_wider
library(ggplot2)  # ggplot, geom_line, facet_wrap, ...


## Coale & Demeny West Female Table
lx_west_female <- tribble(
    ~idade, ~n1, ~n2, ~n3, ~n4, ~n5, ~n6, ~n7, ~n8, ~n9, ~n10, ~n11, ~n12, ~n13, ~n14, ~n15, ~n16, ~n17, ~n18, ~n19, ~n20, ~n21, ~n22, ~n23, ~n24, ~n25,
    "0",1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
    "1",0.63444576156,0.66600679776,0.69443807444,0.72026293424,0.74388301408,0.76561315612,0.78570859648,0.80437156132,0.82177757072,0.8380620052,0.8533516382,0.86774307816,0.88120656228,0.893955513242331,0.906058303286453,0.917687051330823,0.928831391467264,0.939480775554604,0.949637305866833,0.959306371080035,0.968828720349441,0.977176716757063,0.984699447041673,0.990942506559241,0.995544922983919,
    "5",0.468360949406297,0.507761947219212,0.544562330219908,0.579062402438027,0.611511703633229,0.642119509240694,0.671068626393251,0.698508256218783,0.724580750831115,0.749393506870836,0.773060282711157,0.795663963517496,0.817475640696605,0.840117139846358,0.860356510155994,0.87953167740773,0.897706326068912,0.91494383554056,0.931322525386227,0.94691550949291,0.961260847454524,0.972590233732232,0.982295013245734,0.989915266002132,0.99522123327378,
    "10",0.434086134078148,0.473962652070875,0.511558519121757,0.54710203554957,0.580787765418741,0.61278233819249,0.643235333795346,0.672269234039261,0.700005784353532,0.726534797048125,0.751957065342626,0.776343749849522,0.799932640276806,0.824559553264191,0.846723366919306,0.867773193525725,0.887768055256039,0.906769502940974,0.924858042426656,0.942110442041313,0.957973845724345,0.97042089133412,0.981028559177848,0.989293197017307,0.994984763660996,
    "15",0.409245662187984,0.449294949615965,0.487320791157807,0.523498755572251,0.557982333716348,0.590905692278219,0.622392639995791,0.652544612426717,0.68146677628026,0.709234663800244,0.735938233765364,0.761638824760697,0.786561232863871,0.812771851844969,0.836334062697354,0.858765221923826,0.880118307845757,0.900450859993073,0.919842444556781,0.938370188549651,0.955340740855171,0.968657905764612,0.979980764141136,0.988766624555165,0.994778407143956,
    "20",0.378961474706503,0.418994567800666,0.45733583991673,0.494097841058544,0.529384207474199,0.563289131265679,0.595904223066087,0.627304323956827,0.657573302220601,0.68676823565288,0.714964768015698,0.742211253951551,0.768699124662184,0.796313343245938,0.821683871062759,0.845913346780291,0.8690429279277,0.891121233711108,0.912223427445547,0.932424612990159,0.951111776947723,0.965787477701379,0.978226260782616,0.987852277532744,0.994402183589486,
    "25",0.344135923214708,0.383861815067095,0.422303484230657,0.45950293441709,0.495506882548276,0.530363055489393,0.564124976166006,0.596835583055085,0.628552716915639,0.659310715046272,0.689167174425977,0.718154031191198,0.746422158974467,0.775384087658935,0.802908877369353,0.829302608956631,0.854588298734276,0.878799903152896,0.902003641343222,0.924269014902087,0.945081250194616,0.961767921456091,0.975723347597056,0.986516675081742,0.993835102562505,
    "30",0.308820314586812,0.347897377461508,0.386134604999317,0.423505627530952,0.460000587831435,0.495619978077574,0.530377766560929,0.564283184549991,0.597365987022796,0.629635700703595,0.66112975718595,0.691861641271477,0.721938270203203,0.752251057949137,0.781972672641169,0.810613636082994,0.838173593081518,0.864666142653801,0.890142935697933,0.914662568308811,0.937815347883545,0.956801020182839,0.97255252875734,0.984770066450748,0.993061604946507,
    "35",0.273118349204317,0.311166729375326,0.348855290359527,0.386093581586091,0.422817074158091,0.458979378861638,0.494554225331794,0.529515867398928,0.563864243272714,0.597582190585357,0.630684924785201,0.66316543838926,0.695083075991721,0.726928974936353,0.758829259793238,0.789753865218342,0.819674599821252,0.848579021108488,0.876497898935813,0.903472407278667,0.929204633445044,0.950626344813428,0.968488398045549,0.982442317167479,0.99197595252982,
    "40",0.23873768430172,0.275347771662087,0.312082571051808,0.348798107684709,0.385382257716483,0.421746374447363,0.457826764287047,0.49356435176013,0.528929865259798,0.56387959094507,0.598406023967439,0.63248100188285,0.666115303316848,0.699487863185733,0.733364151229663,0.766437207932855,0.79864874183004,0.829955621461084,0.86036120785074,0.889881611788212,0.91833300075333,0.942416130651165,0.962808272651399,0.978973349187383,0.990213327591018,
    "45",0.206898367553849,0.241681144211586,0.277043814429416,0.312803942379229,0.348813021179811,0.384948485557851,0.421115308847987,0.457225639265493,0.493224080561606,0.529042744648061,0.564652736746148,0.600005771455395,0.635066022632021,0.669754656730418,0.705214521367833,0.740109806823563,0.774354813984145,0.807875238090143,0.840643416678674,0.872644482076531,0.903749180156887,0.930790130854913,0.954217795537249,0.973261666725348,0.98696205641873,
    "50",0.177770996510456,0.210341507315842,0.243890700586796,0.278214514338105,0.313141384071544,0.348525394193647,0.384248467414194,0.420200656888251,0.456305456287318,0.492475049478626,0.528662070882458,0.564800699421814,0.600812958091367,0.636330976354249,0.672821353605008,0.709037261107005,0.744873399198402,0.780229171365405,0.815047220056304,0.849280052368999,0.882900402167471,0.913176840689445,0.940213777224647,0.963026109572747,0.980350199393539,
    "55",0.145975043824641,0.175597794065015,0.206611289809793,0.238803174432789,0.271988652084164,0.306005575797136,0.340717723594908,0.375996478364183,0.411746114894773,0.447860115537642,0.484272763094892,0.520900539482847,0.557620202526002,0.593763261008133,0.631023399750598,0.668381481798174,0.705717734130169,0.742907629778405,0.779863492504806,0.816501818314151,0.852841185264296,0.887031460062942,0.918658114070802,0.94652757919741,0.969027383852893,
    "60",0.113587240847696,0.139474691526992,0.167115462050598,0.196310673042483,0.226880013498381,0.258659445759381,0.291505971983532,0.325281570858169,0.359878208864438,0.395176520523367,0.431096343848949,0.467539863537481,0.504341343470107,0.540460437680075,0.577881250107058,0.615843086241726,0.654222921982949,0.69288112876393,0.731705118993279,0.770577504149827,0.809678170107436,0.848286064143164,0.885439140209521,0.919810322913534,0.949465461722011,
    "65",0.0779668950959475,0.0988258749827405,0.12174584968427,0.146573318108746,0.173158970655644,0.201358729337912,0.231040406471372,0.262071083022774,0.294341380780409,0.327728393380067,0.362143844319699,0.397481052730832,0.433533956255605,0.46887908988147,0.505673856516076,0.543573356564644,0.582467935616266,0.622216300648943,0.662689813103978,0.703741451001962,0.74563032966533,0.789501509490886,0.833660413827783,0.876755062950665,0.916581243789729,
    "70",0.0470506405024493,0.0621432517146755,0.0793354728864652,0.0985541082048905,0.119714608848269,0.142724633079919,0.167491837732357,0.193915303120532,0.221907635876793,0.251364471883368,0.28220749423423,0.31433858329484,0.347537675221419,0.379938063336694,0.414035279775541,0.449774188635426,0.487089531811575,0.525871178337013,0.566004929397969,0.607342239915421,0.65036872074313,0.698515749989326,0.749394690938427,0.802133932227154,0.854766800392218,
    "75",0.0221684053920912,0.0311600485903683,0.0419434151900285,0.0545444216618808,0.0689669394783251,0.085196697075546,0.103208321838719,0.122960553756289,0.144413915925688,0.167508843647385,0.192199878367497,0.218420674225088,0.245975858796118,0.272783223743456,0.301388590232902,0.332015306618591,0.364673812087322,0.399323627648676,0.435905508980451,0.474312267363316,0.51523427307362,0.564633277869275,0.619660840950161,0.680618097187722,0.746673474236998,
    "80",0.00732598920807079,0.0113047397594389,0.016438314755029,0.0228196054992297,0.0305220105617721,0.0396008683283948,0.050097271003426,0.0620354335935317,0.0754335803696726,0.0902909642659026,0.106609880769587,0.12437368250882,0.143456202172261,0.162104880208973,0.182247286163336,0.204352879720415,0.228511978988516,0.254772938616741,0.283161455778392,0.313654599795329,0.347020258280922,0.390614533517729,0.442011019525173,0.503149650087724,0.575435365019613,
    "85",0.00162413505038006,0.00275829925064598,0.00435877066841908,0.00650982345628856,0.00929140295188504,0.0127776645122825,0.0170368961120424,0.0221292507905158,0.0281104206175014,0.0350253131178657,0.0429175418473304,0.0518188870376692,0.0616938183986113,0.071484665225327,0.0822723261812461,0.0944940839261368,0.108285301543103,0.123762286434681,0.141029461271215,0.160159820500975,0.181831875372298,0.212616671316956,0.251426061315928,0.301515201578838,0.366799330071358,
    "90",0.000172882557401547,0.000333276067243316,0.000588389716506946,0.000969353142553717,0.0015103869730245,0.00224800809512885,0.00322045564317527,0.0044665959231094,0.00602623996365393,0.00793800470162446,0.0102413463953965,0.012973195163718,0.0161469124627983,0.0193811485709826,0.0230552307501405,0.0273949809765546,0.0325028710227069,0.0384829894463554,0.0454424560341903,0.0534819049278467,0.0630135347656203,0.077843429493963,0.098131129138154,0.127004157492453,0.169262465207974,
    "95",0.00000618126399727685,0.0000140502352039618,0.0000286837177554284,0.0000537898376991005,0.0000941706509476873,0.000155780731401453,0.000245767234235537,0.000372425566885522,0.00054525928942431,0.000774753066329158,0.00107258638597441,0.00145118906573501,0.00192015825558574,0.00241987706002726,0.00301343821412668,0.00375364318455215,0.00467428852118326,0.00581396068844411,0.00721667148136136,0.00893016716564189,0.0110863612413817,0.0148024489177717,0.0204368437440494,0.0294998055279815,0.0448479166843185
)

## Coale & Demeny West Male Table
lx_west_male <- tribble(
    ~idade, ~n1, ~n2, ~n3, ~n4, ~n5, ~n6, ~n7, ~n8, ~n9, ~n10, ~n11, ~n12, ~n13, ~n14, ~n15, ~n16, ~n17, ~n18, ~n19, ~n20, ~n21, ~n22, ~n23, ~n24, ~n25,
    "0",1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
    "1",0.58049766038,0.6161452092,0.64826294576,0.67743500634,0.70411607322,0.72865975498,0.75135921514,0.77243970366,0.79209799062,0.81049728764,0.82776256762,0.8440215917,0.859845453367668,0.874883458468235,0.888055778716697,0.900852983627191,0.913237547670869,0.925186968263735,0.936671333005335,0.947683268619837,0.958680750416065,0.9690200418034,0.97839381250045,0.986529910721376,0.992893667171821,
    "5",0.429571292685077,0.470624990071738,0.509067670734534,0.545179123594612,0.579202655761036,0.61134057985521,0.641780120879294,0.670665248839711,0.698136688628905,0.72431658482177,0.749294308986372,0.773180446408687,0.79846268529548,0.821966448627214,0.842369586581117,0.862051884557836,0.881000444579342,0.899228502813804,0.916737187792765,0.93355742637061,0.949387020594024,0.963033176734909,0.975001916632832,0.984926638952758,0.992314914734876,
    "10",0.400538273474059,0.44161734995643,0.480419409366141,0.517153049282893,0.552006775756775,0.585139969780263,0.616706368065491,0.646822618872768,0.675608007007558,0.703167360442375,0.729574923986421,0.754930582233556,0.781926651218862,0.807029453186083,0.828905999059428,0.850083014737147,0.870536735676534,0.890272004685602,0.909281253582517,0.927590105634545,0.944824528036515,0.959710383233357,0.972802502628941,0.983653991905198,0.991711747170695,
    "15",0.381119930695723,0.422077669781735,0.460995969898029,0.49803671337573,0.533351773546335,0.567071365204334,0.59932607593191,0.630213440984409,0.659837479058001,0.688290517606341,0.715635808025789,0.74196521602135,0.770199598361517,0.796328241317667,0.81916929960461,0.841341758605927,0.862813423451031,0.883581954867979,0.903632083058174,0.922983891751058,0.941183430317313,0.956987361249115,0.970938745416583,0.982527870407977,0.991146182784926,
    "20",0.356291587652807,0.396906455340772,0.4357920829474,0.473053116000841,0.508795920285922,0.543114058015967,0.576108634665268,0.607852663334624,0.638430301590797,0.667917454597706,0.696362892846957,0.723847642157769,0.753233104610792,0.780604822825689,0.804641797345199,0.828071826439553,0.850850149998992,0.872962769399412,0.894381576789789,0.915116376665149,0.934712245451122,0.951948630949428,0.96730828721478,0.98018251052991,0.989857277890968,
    "25",0.323386988032438,0.36335264810705,0.402019306812614,0.439417936335889,0.47559531304222,0.510596295780978,0.544482221838719,0.577292668215833,0.60908432343646,0.639910124915603,0.669798448840577,0.698814747089994,0.729694514864653,0.758713697135088,0.784398503511145,0.809566699656655,0.834156138865844,0.858136645662659,0.881462260511741,0.904128460283924,0.92571218597349,0.944961152645446,0.962295201091559,0.976964139357663,0.988104826790113,
    "30",0.289871097593737,0.328919209063225,0.367135960051928,0.404480663490305,0.440940614263513,0.476510981790837,0.51121165340705,0.545046789406796,0.578043419160589,0.610229297619023,0.641610187961581,0.672233875243744,0.7047009328505,0.735488997801149,0.762980318329111,0.790054854208692,0.816632044086531,0.84266483091742,0.86808868117279,0.892884430038556,0.916593718968172,0.937982063216707,0.95738283112269,0.973891293243834,0.986491135076871,
    "35",0.25516465099642,0.292922710195337,0.330361445176884,0.367372155841723,0.403883775987519,0.43984138474979,0.475221975349584,0.509992357911547,0.544147565064482,0.577687702078301,0.61059338564783,0.642892248870261,0.677035526412815,0.709752508114733,0.739190855742855,0.768340012236909,0.797099392776228,0.825403228779513,0.853166066732825,0.880351889685412,0.906372653381546,0.930156088619591,0.951876596274909,0.970452379299924,0.984691111245811,
    "40",0.219613969784273,0.255584376306881,0.291779869509237,0.328032691097482,0.364218603211339,0.400235330090509,0.436017848927025,0.471495510438108,0.506630298902514,0.541393137135844,0.575737703553084,0.609669357488705,0.645471834658983,0.680063466075584,0.711501994449913,0.742828126170152,0.773919547297263,0.80468896331426,0.835025969116088,0.864873236832061,0.893528417179131,0.920146225588005,0.944679687607707,0.965833653606208,0.982186190038691,
    "45",0.183159466220904,0.21669433904766,0.251018627336157,0.285920187731785,0.321231361571296,0.356808892980276,0.392549401396972,0.428346911533906,0.464130938894101,0.499842912275907,0.535408762223699,0.570809985921382,0.60816958806755,0.644541688377723,0.677850560413295,0.711303480293655,0.744757594657304,0.778102592737,0.811198983577237,0.843962056121138,0.875448130527047,0.905510305084794,0.933644650131624,0.958307160908167,0.977760708356498,
    "50",0.148722834858222,0.179178110796341,0.210926225809576,0.24373611575768,0.277416319754254,0.311797863951567,0.346750427653852,0.382141831673347,0.417875662807343,0.453868722596918,0.490023181735641,0.526298749334797,0.56469775386559,0.602150360143969,0.636761264299122,0.671845385522861,0.707248186123106,0.742841635206049,0.77845930604549,0.813987394146804,0.84832694440912,0.882345223331841,0.914959770480875,0.944407731835787,0.968587963005674,
    "55",0.114352855977851,0.140884626233076,0.169151174852423,0.198930210131491,0.230028452685193,0.262268798630735,0.295507451973863,0.32959705892556,0.364423355579641,0.399884669211653,0.435864536731125,0.472303689339182,0.511210979816249,0.54896783954614,0.584238765678483,0.620385322561001,0.657254496710992,0.694710691331774,0.732567777665767,0.770685871718668,0.80777606757692,0.846254937284948,0.884316055812522,0.920070576510739,0.951081648129575,
    "60",0.0833910078477239,0.105356623804179,0.129326461898553,0.155118929429443,0.182567016066973,0.211510173655722,0.24181199195628,0.273328570811397,0.305943122207787,0.339548538842692,0.37402174181284,0.409293025272079,0.447295652795493,0.483981773017671,0.518660293176259,0.554626648579676,0.591749460183057,0.629904171942343,0.668903159153759,0.70859436140952,0.747792340212486,0.790449822689203,0.83423914413253,0.87740042226564,0.917419181979961,
    "65",0.0540445399587125,0.0706562207958936,0.0893591710488994,0.110043547803087,0.132597331470985,0.156902847798622,0.182854051982426,0.210331651753401,0.239234184587963,0.269464652205858,0.300907918238157,0.333494513026633,0.368958066828449,0.403067630212791,0.435773263932977,0.470181397064317,0.506204209300098,0.543749650527108,0.582650908397369,0.622762414180791,0.663117718230272,0.709424572508279,0.75897378025079,0.810441707970049,0.861598861650464,
    "70",0.0302450485065983,0.0413375623988108,0.0543263534696255,0.0691906988802787,0.0858943728309808,0.104385196972204,0.12460999309733,0.146497007093112,0.169981399122108,0.194996339354455,0.221454767426731,0.249303655181849,0.279977971228925,0.309413585394995,0.338102287363646,0.368779881075305,0.401423757338923,0.435999049430036,0.472390802266279,0.510489934495139,0.549713709582074,0.597258534059226,0.650464247201439,0.708899947180792,0.77130579060264,
    "75",0.0133726867705975,0.0194478507225404,0.0269447787049672,0.0359207139888206,0.0464131668141788,0.0584400586220278,0.0720100391492714,0.0871115817597752,0.103730760711036,0.121846347105582,0.141416798708525,0.162420764845814,0.185855829925799,0.208400747849447,0.230800790380465,0.255215444803322,0.281696180010212,0.310280384770286,0.340931723747839,0.373607598575634,0.408146922148746,0.452629658648051,0.504825417236125,0.565678979448192,0.635710733021052,
    "80",0.00389651834603932,0.00627203187831555,0.00944547332445906,0.0135069567984807,0.0185336326738208,0.0245886058940673,0.031725433557097,0.0399821589008003,0.0493905053283778,0.0599736277844476,0.071738267339345,0.0846990747564823,0.0994480593946704,0.113704713030776,0.128211334684739,0.144397982406148,0.162371603783948,0.182230736142426,0.204020665883529,0.227776330368253,0.253653140699957,0.2892388239996,0.333277381602408,0.388093165071281,0.456430336570456,
    "85",0.000773212824231666,0.00137092498112124,0.00224528791551261,0.00345649674584748,0.00506394429271255,0.00712448032502394,0.00969276083429575,0.0128181772537318,0.0165473611455608,0.0209229094818142,0.0259794538092733,0.0317536114838052,0.0385218448864716,0.0451581364872569,0.0521171909263707,0.0601166455255642,0.0692707244726678,0.0796958189489616,0.0914848878191209,0.10472694051097,0.119696582046786,0.141789402346656,0.170922577127521,0.210089879264835,0.26368242068571,
    "90",0.0000723590154315557,0.000145553213773118,0.0002662088332661,0.000451867066748717,0.000722398867834514,0.00109951876319344,0.00160659699460842,0.00226777833360432,0.00310816025836259,0.00415327313381213,0.00542778759247294,0.00695770192205581,0.00883026231938016,0.0107156550277211,0.012772559503725,0.015231198667003,0.0181587751280966,0.0216294700818169,0.0257156796008546,0.0304935705396065,0.0361549312090591,0.0452034028738185,0.0581098441437849,0.0771803770157088,0.106414309087131,
    "95",0.00000225190664918348,0.00000532741631967915,0.0000112410957271001,0.0000216733852024214,0.0000388554719470384,0.0000656097875458697,0.000105394523316254,0.000162278566125876,0.000240980225355301,0.000346841640623338,0.000485693117853551,0.000664077561941559,0.00089610642257287,0.00113992333074812,0.00141999689793955,0.00177226940549012,0.00221414663118222,0.00276645238040612,0.0034523588548578,0.00429844327459112,0.00536285782437546,0.00722875702742187,0.0101680096500026,0.0150620375698094,0.0237291642809883
)

## Tábua de vida masculina do Brasil em 2010
tvbr2010_male <- tribble(
    ~idade, ~populacao, ~obitos, ~mxn, ~x, ~qxn, ~lx, ~dxn, ~Lxn, ~Tx, ~ex,
    "Menos de 1 ano",1378532,25588.2667163595,0.0185619678878398,0,0.01826,100000,1826,98348,7020533,70.21,
    "1 a 4 anos",5638455,4108.84139745182,0.000728717600380215,1,0.00291,98174,286,392012,6922185,70.51,
    "5 a 9 anos",7624144,2569.61227102366,0.000337036167079695,5,0.00168,97889,165,489032,6530174,66.71,
    "10 a 14 anos",8725413,3729.78012260246,0.0004274617284709,10,0.00214,97724,209,488098,6041142,61.82,
    "15 a 19 anos",8558868,15965.1709974369,0.0018653367475041,15,0.00928,97515,905,485314,5553044,56.95,
    "20 a 24 anos",8630229,24378.7493400855,0.0028248090914025,20,0.01403,96610,1355,479663,5067730,52.46,
    "25 a 29 anos",8460995,24047.2189213004,0.00284212659637553,25,0.01411,95255,1344,472915,4588067,48.17,
    "30 a 34 anos",7717658,23575.2546724307,0.00305471616809539,30,0.01516,93911,1423,465996,4115152,43.82,
    "35 a 39 anos",6766664,24179.647446127,0.00357334832143682,35,0.01771,92488,1638,458343,3649155,39.46,
    "40 a 44 anos",6320568,29259.9254379974,0.00462931898493892,40,0.02288,90850,2079,449052,3190812,35.12,
    "45 a 49 anos",5692014,36575.2892105618,0.00642572017752623,45,0.03162,88771,2807,436837,2741761,30.89,
    "50 a 54 anos",4834995,44698.8345359139,0.009244856413691,50,0.04518,85964,3884,420110,2304923,26.81,
    "55 a 59 anos",3902344,50957.5401326354,0.0130581876258565,55,0.06323,82080,5190,397426,1884814,22.96,
    "60 a 64 anos",3041035,55298.8354940522,0.0181842154049697,60,0.08697,76890,6687,367735,1487387,19.34,
    "65 a 69 anos",2224065,59400.3028312914,0.0267079886744728,65,0.12518,70203,8788,329047,1119653,15.95,
    "70 a 74 anos",1667372,67055.8308106221,0.0402164788725144,70,0.18271,61415,11221,279023,790606,12.87,
    "75 a 79 anos",1090517,66656.020859603,0.0611233211949955,75,0.26511,50194,13307,217703,511583,10.19,
    "80 a 84 anos",668623,60517.3834477199,0.0905104721909356,80,0.36905,36887,13613,150403,293880,7.97,
    "85 a 89 anos",310759,41957.8262396213,0.135017252081585,85,0.50472,23274,11747,87003,143477,6.16,
    "90 anos e mais",153740,31380.9199866573,0.204116820519431,90,1,11527,11527,56473,56473,4.9
    )


## Tábua de vida feminina do Brasil em 2010
tvbr2010_female <- tribble(
    ~idade, ~populacao, ~obitos, ~mxn, ~x, ~qxn, ~lx, ~dxn, ~Lxn, ~Tx, ~ex,
    "Menos de 1 ano",1334712,20527.2863359099,0.0153795622845302,0,0.01517,100000,1517,98628,7738217,77.38,
    "1 a 4 anos",5444459,3467.17123487435,0.000636825667136873,1,0.00254,98483,250,393306,7639589,77.57,
    "5 a 9 anos",7345231,1923.65542679923,0.000261891753547196,5,0.00131,98233,129,490842,7246283,73.77,
    "10 a 14 anos",8441348,2444.12197214965,0.000289541667059533,10,0.00145,98104,142,490166,6755441,68.86,
    "15 a 19 anos",8432004,4389.44282621798,0.000520569348190297,15,0.0026,97962,255,489174,6265275,63.96,
    "20 a 24 anos",8614963,5489.0032488777,0.000637147628942539,20,0.00318,97708,311,487761,5776100,59.12,
    "25 a 29 anos",8643419,6856.87407389215,0.000793305759432945,25,0.00396,97397,386,486020,5288339,54.3,
    "30 a 34 anos",8026854,8600.02499146661,0.00107140667956171,30,0.00534,97011,518,483760,4802319,49.5,
    "35 a 39 anos",7121915,10361.8285891158,0.00145492168737141,35,0.00725,96493,699,480716,4318559,44.76,
    "40 a 44 anos",6688796,14424.2520316327,0.00215647958640579,40,0.01072,95794,1027,476399,3837843,40.06,
    "45 a 49 anos",6141338,20408.7777823603,0.00332318100426328,45,0.01648,94766,1562,469927,3361444,35.47,
    "50 a 54 anos",5305407,25911.6663993569,0.00488401104747607,50,0.02413,93205,2249,460401,2891517,31.02,
    "55 a 59 anos",4373877,31287.295322306,0.00715321791680607,55,0.03514,90956,3196,446790,2431116,26.73,
    "60 a 64 anos",3468085,36899.5716470333,0.0106397541141677,60,0.05182,87760,4548,427430,1984327,22.61,
    "65 a 69 anos",2616745,43312.8555243609,0.0165521881285188,65,0.07947,83212,6613,399528,1556896,18.71,
    "70 a 74 anos",2074264,54391.7872669226,0.0262222105127036,70,0.12304,76599,9425,359433,1157368,15.11,
    "75 a 79 anos",1472930,61601.3885018449,0.041822346277043,75,0.18932,67174,12717,304077,797935,11.88,
    "80 a 84 anos",998349,68628.9907929398,0.0687424846350723,80,0.29331,54457,15972,232353,493858,9.07,
    "85 a 89 anos",508724,56774.5452130446,0.111601861152697,85,0.43628,38484,16790,150446,261506,6.8,
    "90 anos e mais",295389,57700.8267792555,0.195338441103953,90,1,21694,21694,111060,111060,5.12
)


## escolha de três níveis de mortalidade aleatoriamente
set.seed(009681)
ns <- paste0( 'n', sort(sample(x = 1:25, size = 3)) ) 

dat <- bind_rows(
    ## Níveis de Mortalidade Coale & Demeny Padrão Oeste
    bind_rows(
        lx_west_female %>% mutate( sexo = 'feminino' ),
        lx_west_male %>% mutate( sexo = 'masculino' )
    ) %>%
    mutate( idade = as.numeric(idade) ) %>%
    select( sexo, idade, n1:n25) %>%
    pivot_longer(
        cols = n1:n25
       ,names_to = 'ref'
       ,values_to = 'lx'
    )
    ## Tábuas de Vida Brasileiras (Censo 2010)
   ,bind_rows(
        tvbr2010_male %>%
        transmute(
            sexo = 'masculino',
            idade = c(0,1,seq(from = 5, to = 90, by = 5)),
            ref = 'TV_BR2010',
            lx = lx / 1e5
        ),
        tvbr2010_female %>%
        transmute(
            sexo = 'feminino',
            idade = c(0,1,seq(from = 5, to = 90, by = 5)),
            ref = 'TV_BR2010',
            lx = lx / 1e5
        )
    ) 
) %>%
    mutate(
        idade = factor(
            as.character(idade),
            levels = c(0,1,seq(from = 5, to = 95, by = 5)),
            labels = c('<1','1-4','5-9','10-14','15-19','20-24','25-29',
                       '30-34','35-39','40-44','45-49','50-54','55-59',
                       '60-64','65-69','70-74','75-79','80-84','85-89',
                       '90-94','95+'
                       )
        )
    )

dat %>% 
    filter( ref != 'TV_BR2010' ) %>%
    ggplot( aes( x = idade, y = lx, group = ref ) ) +
    geom_line( color = 'lightgrey'  ) +
    geom_line( aes( x = idade, y = lx, color = ref), data = dat %>% filter( ref %in% ns ) %>% mutate( ref = paste0('Coale&Demeny_West_',ref))) +
    geom_line( aes( x = idade, y = lx, group = ref, color = ref ), linetype = 'dashed', data = dat %>% filter( ref == 'TV_BR2010' ) ) +
    geom_text( aes( x = idade, y = lx, label = ref ), data = dat %>% filter( idade == '55-59', ref != 'TV_BR2010' ), size = 3 ) + 
    labs(
        x = 'idade',
        y = 'lx (radix = 1)',
        group = '',
        color = ''
    ) +
    theme(legend.position = "top", axis.text.x = element_text(angle = 90)) + 
    facet_wrap( ~sexo ) 


